<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.example.mapper.UserMapper">


<!-- 권한 읽기 -->
	<select id="readAuthorities" parameterType="String" resultType="org.springframework.security.core.authority.SimpleGrantedAuthority">
		SELECT u_auth
		FROM user_auth
		WHERE 1=1
		AND u_id = #{username}
	</select>
<!-- 회원 정보 가져오기 -->
	<select id="readUser" parameterType="String" resultType="User">
		SELECT 
			u_id							as	username,
			u_passwd						as  password,
			u_name,
			u_isAccountNonExpired			as	isAccountNonExpired,
			u_isAccountNonLocked			as	isAccountNonLocked,
			u_isCredentialsNonExpired		as	isCredentialsNonExpired,
			u_isEnabled						as	isEnabled,
			u_gender,
			u_birth,
			u_tel,
			u_addr
		FROM user
		WHERE 1=1
		AND	u_id = #{username}
	</select>
		
<!-- 회원 등록 -->
	<insert id="createUser" parameterType="User">
		INSERT INTO user(
			u_id,
			u_passwd,
			u_name,
			u_isAccountNonExpired,
			u_isAccountNonLocked,
			u_isCredentialsNonExpired,
			u_isEnabled,
			u_gender,
			u_birth,
			u_tel,
			u_addr
		)VALUES (
			#{username},
			#{password},
			#{u_name},
			#{isAccountNonExpired},
			#{isAccountNonLocked},
			#{isCredentialsNonExpired},
			#{isEnabled},
			#{u_gender},
			#{u_birth},
			#{u_tel},
			#{u_addr}
		)
	</insert>
<!-- 유저 권한 추가 -->
	<insert id="createAuthority" parameterType="org.springframework.security.core.GrantedAuthority">
		INSERT INTO user_auth(
			u_id,
			u_auth
		)VALUES
			<foreach item="authority" index="index" collection="authorities" separator=",">
				(#{username}, #{authority.role})
			</foreach>
		ON DUPLICATE KEY
		UPDATE
			u_id = #{username}

	</insert>
<!-- 회원 수정 -->
	<update id="userUpdate" parameterType="User">
		UPDATE user	
		SET	
			u_name =#{u_name},
			u_gender=#{u_gender},
			u_birth=#{u_birth},
			u_tel=#{u_tel},
			u_addr=#{u_addr}
		WHERE
			u_id=#{username}
	</update>
	
	
<!-- 회원 삭제 -->
	<delete id="userDelete" parameterType="String">
		DELETE FROM user
		WHERE u_id=#{username}
	</delete>

</mapper>